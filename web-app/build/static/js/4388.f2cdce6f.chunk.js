"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[4388],{94388:(e,s,i)=>{i.r(s),i.d(s,{default:()=>C});var t=i(89379),n=i(9950),a=i(28429),r=i(89132),l=i(1531),c=i(93598),d=i(49078),o=i(99491),p=i(98341),x=i(86070),h=i(30272),u=i(44414);const f=e=>{let{rowData:s,rowId:i,onFieldChange:t,onAddClick:a,onRemoveClick:l,canAdd:c=!0,canRemove:d=!0,showRowActions:o=!0,disabledFields:p=[],fieldErrors:x={}}=e;const{endpoint:f="",accessKey:j="",secretKey:g="",name:m=""}=s;return(0,u.jsxs)(n.Fragment,{children:[(0,u.jsx)(r.azJ,{children:(0,u.jsx)(r.cl_,{id:"add-rep-peer-site-".concat(i),name:"add-rep-peer-site-".concat(i),placeholder:"site-name",label:"",readOnly:p.includes("name"),value:m,onChange:e=>{t(e,"name",i)},"data-test-id":"add-site-rep-peer-site-".concat(i)})}),(0,u.jsx)(r.azJ,{children:(0,u.jsx)(r.cl_,{id:"add-rep-peer-site-ep-".concat(i),name:"add-rep-peer-site-ep-".concat(i),placeholder:"https://dr.minio-storage:900".concat(i),label:"",readOnly:p.includes("endpoint"),error:x.endpoint,value:f,onChange:e=>{t(e,"endpoint",i)},"data-test-id":"add-site-rep-peer-ep-".concat(i)})}),(0,u.jsx)(r.azJ,{children:(0,u.jsx)(r.cl_,{id:"add-rep-peer-site-ac-".concat(i),name:"add-rep-peer-site-ac-".concat(i),label:"",required:!0,disabled:p.includes("accessKey"),value:j,error:x.accessKey,onChange:e=>{t(e,"accessKey",i)},"data-test-id":"add-rep-peer-site-ac-".concat(i)})}),(0,u.jsx)(r.azJ,{children:(0,u.jsx)(r.cl_,{id:"add-rep-peer-site-sk-".concat(i),name:"add-rep-peer-site-sk-".concat(i),label:"",required:!0,type:"password",value:g,error:x.secretKey,disabled:p.includes("secretKey"),onChange:e=>{t(e,"secretKey",i)},"data-test-id":"add-rep-peer-site-sk-".concat(i)})}),(0,u.jsx)(r.xA9,{item:!0,xs:12,sx:{alignItems:"center",display:"flex"},children:(0,u.jsx)(r.azJ,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"baseline",marginTop:"4px","& button":{borderColor:"#696969",color:"#696969",borderRadius:"50%"}},children:o?(0,u.jsxs)(n.Fragment,{children:[(0,u.jsx)(h.A,{tooltip:"Add a Row",children:(0,u.jsx)(r.$nd,{id:"add-row-".concat(i),variant:"regular",disabled:!c,icon:(0,u.jsx)(r.REV,{}),onClick:e=>{e.preventDefault(),null===a||void 0===a||a(i)},style:{width:25,height:25,padding:0}})}),(0,u.jsx)(h.A,{tooltip:"Remove Row",children:(0,u.jsx)(r.$nd,{id:"remove-row-".concat(i),variant:"regular",disabled:!d,icon:(0,u.jsx)(r.YPx,{}),onClick:e=>{e.preventDefault(),null===l||void 0===l||l(i)},style:{width:25,height:25,padding:0,marginLeft:8}})})]}):null})})]},"".concat(i))};var j=i(82817),g=i(98167);const m=e=>{let s=!1;try{new URL(e),s=!0}catch(i){s=!1}return s?"":"Invalid Endpoint"},y=e=>""===(null===e||void 0===e?void 0:e.trim()),K=()=>(0,u.jsxs)(n.Fragment,{children:[(0,u.jsx)(r.azJ,{children:(0,u.jsx)(r.l1Y,{children:"Site Name"})}),(0,u.jsx)(r.azJ,{children:(0,u.jsxs)(r.l1Y,{children:["Endpoint ","*"]})}),(0,u.jsx)(r.azJ,{children:(0,u.jsxs)(r.l1Y,{children:["Access Key ","*"]})}),(0,u.jsx)(r.azJ,{children:(0,u.jsxs)(r.l1Y,{children:["Secret Key ","*"]})}),(0,u.jsx)(r.azJ,{children:" "})]}),v=e=>{let{title:s}=e;return(0,u.jsx)(r.xA9,{item:!0,xs:12,children:(0,u.jsx)(r.azJ,{sx:{marginBottom:"15px",fontSize:"14px",fontWeight:600},children:s})})},C=()=>{const e=(0,o.jL)(),s=(0,a.Zp)(),{serverEndPoint:i=""}=(0,p.d4)(x.h0),[h,C]=(0,n.useState)([{endpoint:i,name:"",accessKey:"",secretKey:""}]),[w,A]=(0,n.useState)([]),b=()=>{A([{endpoint:"",name:"",accessKey:"",secretKey:""}])},[z,S]=(0,l.A)(e=>{const{sites:s,name:i}=e,n=s.findIndex(e=>e.name===i);if(-1!==n){let e=s[n];e=(0,t.A)((0,t.A)({},e),{},{isCurrent:!0,isSaved:!0}),C([e]),s.splice(n,1)}s.sort((e,s)=>e.name===i?-1:s.name===i?1:0);let a=s.map(e=>(0,t.A)((0,t.A)({},e),{},{accessKey:"",secretKey:"",isSaved:!0}));a.length?A(a):b()},e=>{b()}),k=()=>{S("GET","api/v1/admin/site-replication")};(0,n.useEffect)(()=>{k()},[]),(0,n.useEffect)(()=>{e((0,d.ph)("add-replication-sites"))},[]);const J=w.reduce((e,s,i)=>{const t=w[i].endpoint,n=m(t);return""===n&&""!==t&&e.push(n),e},[]),T=w.map(e=>!y(e.accessKey)&&!y(e.secretKey)).filter(Boolean),{accessKey:E,secretKey:R}=h[0],I=!y(E)&&!y(R),B=J.length===w.length,F=T.length===w.length;let L=I&&B&&F;const[_,q]=(0,l.A)(i=>{i.success?(e((0,d.Hk)(i.status)),O(),k(),s(c.zZ.SITE_REPLICATION)):e((0,d.C9)({errorMessage:"Error",detailedError:i.status}))},s=>{e((0,d.C9)(s))}),O=()=>{b(),C(e=>e.map((e,s)=>(0,t.A)((0,t.A)({},e),{},{accessKey:"",secretKey:"",name:""})))};return(0,u.jsxs)(n.Fragment,{children:[(0,u.jsx)(j.A,{label:(0,u.jsx)(r.EGL,{label:"Add Replication Site",onClick:()=>s(c.zZ.SITE_REPLICATION)}),actions:(0,u.jsx)(g.A,{})}),(0,u.jsx)(r.Mxu,{children:(0,u.jsxs)(r.azJ,{sx:{display:"grid",padding:"25px",gap:"25px",gridTemplateColumns:"1fr",border:"1px solid #eaeaea"},children:[(0,u.jsxs)(r.azJ,{children:[(0,u.jsx)(r._xt,{separator:!0,icon:(0,u.jsx)(r.pHQ,{}),children:"Add Sites for Replication"}),z||_?(0,u.jsx)(r.z21,{}):null,(0,u.jsx)(r.azJ,{sx:{fontSize:"14px",fontStyle:"italic",marginTop:"10px",marginBottom:"10px"},children:"Note: AccessKey and SecretKey values for every site is required while adding or editing peer sites"}),(0,u.jsxs)("form",{noValidate:!0,autoComplete:"off",onSubmit:e=>(e.preventDefault(),(()=>{const e=null===h||void 0===h?void 0:h.map((e,s)=>({accessKey:e.accessKey,secretKey:e.secretKey,name:e.name,endpoint:e.endpoint.trim()})),s=w.reduce((e,s,i)=>(s.endpoint&&e.push({accessKey:s.accessKey,secretKey:s.secretKey,name:s.name||"dr-site-".concat(i),endpoint:s.endpoint.trim()}),e),[]),i=e.concat(s);q("POST","api/v1/admin/site-replication",i)})()),children:[(0,u.jsxs)(r.azJ,{sx:{marginTop:"15px"},children:[(0,u.jsx)(v,{title:"This Site"}),(0,u.jsxs)(r.azJ,{withBorders:!0,sx:{display:"grid",gridTemplateColumns:".8fr 1.2fr .8fr .8fr .2fr",padding:"15px",gap:"10px",maxHeight:"430px",overflowY:"auto"},children:[(0,u.jsx)(K,{}),h.map((e,s)=>{const i=y(e.accessKey)?"AccessKey is required":"",n=y(e.secretKey)?"SecretKey is required":"";return(0,u.jsx)(f,{rowData:e,rowId:s,fieldErrors:{accessKey:i,secretKey:n},onFieldChange:(e,s,i)=>{const n=e.target.value;""!==s&&C(e=>e.map((e,a)=>a===i?(0,t.A)((0,t.A)({},e),{},{[s]:n}):e))},showRowActions:!1},"current-".concat(s))})]})]}),(0,u.jsxs)(r.azJ,{sx:{marginTop:"25px"},children:[(0,u.jsx)(v,{title:"Peer Sites"}),(0,u.jsxs)(r.azJ,{withBorders:!0,sx:{display:"grid",gridTemplateColumns:".8fr 1.2fr .8fr .8fr .2fr",padding:"15px",gap:"10px",maxHeight:"430px",overflowY:"auto"},children:[(0,u.jsx)(K,{}),w.map((e,s)=>{const i=m(e.endpoint),n=y(e.accessKey)?"AccessKey is required":"",a=y(e.secretKey)?"SecretKey is required":"";return(0,u.jsx)(f,{rowData:e,rowId:s,fieldErrors:{endpoint:i,accessKey:n,secretKey:a},onFieldChange:(e,s,i)=>{const n=e.target.value;A(e=>e.map((e,a)=>a===i?(0,t.A)((0,t.A)({},e),{},{[s]:n}):e))},canAdd:!0,canRemove:s>0&&!e.isSaved,onAddClick:()=>{const e=[...w];e.splice(s+1,0,{name:"",endpoint:"",accessKey:"",secretKey:""}),A(e)},onRemoveClick:e=>{A(w.filter((s,i)=>i!==e))}},"exiting-".concat(s))})]})]}),(0,u.jsx)(r.xA9,{item:!0,xs:12,children:(0,u.jsxs)(r.azJ,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",marginTop:"20px",gap:"15px"},children:[(0,u.jsx)(r.$nd,{id:"clear",type:"button",variant:"regular",disabled:_,onClick:O,label:"Clear"}),(0,u.jsx)(r.$nd,{id:"save",type:"submit",variant:"callAction",disabled:_||!L,label:"Save"})]})})]})]}),(0,u.jsx)(r.lVp,{title:"",iconComponent:null,help:(0,u.jsxs)(n.Fragment,{children:[(0,u.jsxs)(r.azJ,{sx:{marginTop:"-25px",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"2px"},children:[(0,u.jsx)(r.azJ,{sx:{backgroundColor:"#07193E",height:"15px",width:"15px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",marginRight:"18px",padding:"3px",paddingLeft:"2px","& .min-icon":{height:"11px",width:"11px",fill:"#ffffff"}},children:(0,u.jsx)(r.pHQ,{})}),"About Site Replication"]}),(0,u.jsxs)(r.azJ,{sx:{display:"flex",flexFlow:"column",fontSize:"14px",flex:"2","& li":{fontSize:"14px",display:"flex",marginTop:"15px",marginBottom:"15px",width:"100%","&.step-text":{fontWeight:400}}},children:[(0,u.jsx)(r.azJ,{children:"The following changes are replicated to all other sites"}),(0,u.jsxs)("ul",{children:[(0,u.jsx)("li",{children:"Creation and deletion of buckets and objects"}),(0,u.jsx)("li",{children:"Creation and deletion of all IAM users, groups, policies and their mappings to users or groups"}),(0,u.jsx)("li",{children:"Creation of STS credentials"}),(0,u.jsx)("li",{children:"Creation and deletion of service accounts (except those owned by the root user)"}),(0,u.jsx)("li",{children:(0,u.jsxs)(r.azJ,{style:{display:"flex",flexFlow:"column",justifyContent:"flex-start"},children:[(0,u.jsx)("div",{style:{paddingTop:"1px"},children:"Changes to Bucket features such as"}),(0,u.jsxs)("ul",{children:[(0,u.jsx)("li",{children:"Bucket Policies"}),(0,u.jsx)("li",{children:"Bucket Tags"}),(0,u.jsx)("li",{children:"Bucket Object-Lock configurations"}),(0,u.jsx)("li",{children:"Bucket Encryption configuration"})]})]})}),(0,u.jsx)("li",{children:(0,u.jsxs)(r.azJ,{style:{display:"flex",flexFlow:"column",justifyContent:"flex-start"},children:[(0,u.jsx)("div",{style:{paddingTop:"1px"},children:"The following Bucket features will NOT be replicated"}),(0,u.jsxs)("ul",{children:[(0,u.jsx)("li",{children:"Bucket notification configuration"}),(0,u.jsx)("li",{children:"Bucket lifecycle (ILM) configuration"})]})]})})]})]})]})})]})})]})}}}]);