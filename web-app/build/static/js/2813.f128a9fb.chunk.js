"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[2813],{52813:(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});var n=s(9950),r=s(98341),o=s(89132);const a="error",l="success",i="inProgress";var d=s(99491),c=s(31690),h=s(49078),x=s(47146),g=s(70444),p=s(44414);const u=e=>{let{title:t,children:s}=e;const[r,a]=(0,n.useState)("N/A"),[l,i]=(0,n.useState)(0),[d,c]=(0,n.useState)(0),[h,x]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{h&&g.F.admin.adminInfo({defaultOnly:!0}).then(e=>{var t;const s=null===(t=e.data.servers)||void 0===t?void 0:t.length;if(i(s||0),e.data.servers&&e.data.servers.length>0){a(e.data.servers[0].version||"N/A");const t=e.data.servers.reduce((e,t)=>e+(t.drives?t.drives.length:0),0);c(t)}x(!1)}).catch(()=>{x(!1)})},[h]),(0,p.jsxs)(o.xA9,{item:!0,xs:12,children:[(0,p.jsx)(o._xt,{separator:!0,children:t}),(0,p.jsxs)(o.xA9,{item:!0,xs:12,children:[(0,p.jsx)(o.xA9,{item:!0,xs:12,sx:{padding:0,marginBottom:25},children:(0,p.jsx)(o.xA9,{container:!0,sx:{padding:25},children:h?(0,p.jsx)(n.Fragment,{children:(0,p.jsx)(o.xA9,{item:!0,xs:12,sx:{textAlign:"center"},children:(0,p.jsx)(o.aHM,{style:{width:25,height:25}})})}):(0,p.jsxs)(n.Fragment,{children:[(0,p.jsxs)(o.xA9,{item:!0,xs:12,md:4,sx:{fontSize:18,display:"flex",alignItems:"center","& svg":{marginRight:10}},children:[(0,p.jsx)(o.JUN,{})," ",(0,p.jsx)("strong",{children:l}),"\xa0nodes,\xa0",(0,p.jsx)("strong",{children:d}),"\xa0 drives"]}),(0,p.jsxs)(o.xA9,{item:!0,xs:12,md:4,sx:{fontSize:12,justifyContent:"center",alignSelf:"center",alignItems:"center",display:"flex"},children:[(0,p.jsx)("span",{style:{marginRight:20},children:(0,p.jsx)(o.mzI,{})})," ","MinIO VERSION\xa0",(0,p.jsx)("strong",{children:r})]})]})})}),s]})]})};var j=s(82817),m=s(98167);const f=()=>{const e=(0,d.jL)(),t=(0,r.d4)(e=>e.healthInfo.message),s=(0,r.d4)(e=>e.system.serverDiagnosticStatus),[g,f]=(0,n.useState)(!1),[w,b]=(0,n.useState)(!0),[v,S]=(0,n.useState)(""),[y,A]=(0,n.useState)("Start Health Report"),[H,R]=(0,n.useState)("Health Report"),[C,I]=(0,n.useState)(""),[k,z]=(0,n.useState)("");(0,n.useEffect)(()=>s===i?(R("Health Report in progress..."),void S("Health Report started. Please do not refresh page during diagnosis.")):s===l?(R("Health Report complete"),S("Health Report file is ready to be downloaded."),void A("Start Health Report")):s===a?(R("Error"),S("An error occurred while getting the Health Report file."),void A("Retry Health Report")):void 0,[s,g]),(0,n.useEffect)(()=>{s===l&&t!=={}&&b(!1),s===i&&b(!0),f(!1)},[s,t]),(0,n.useEffect)(()=>{if(g){e((0,x.Zq)()),I("");const t=new URL(window.location.toString()),s=!1?"9090":t.port,n=(0,c.nw)(t.protocol),r=new URL(document.baseURI).pathname,o=new WebSocket("".concat(n,"://").concat(t.hostname,":").concat(s).concat(r,"ws/health-info?deadline=1h"));let d=null;null!==o&&(o.onopen=()=>{console.log("WebSocket Client Connected"),o.send("ok"),d=setInterval(()=>{o.send("ok")},1e4),S("Health Report started. Please do not refresh page during diagnosis."),e((0,h.f7)(i))},o.onmessage=t=>{let s=JSON.parse(t.data.toString());s.serverHealthInfo&&e((0,x.zJ)(s.serverHealthInfo)),""!==s.encoded&&I(s.encoded),s.subnetResponse&&z(s.subnetResponse)},o.onerror=t=>{console.error("error closing websocket:",t),o.close(1e3),clearInterval(d),e((0,h.f7)(a))},o.onclose=t=>{clearInterval(d),t.code===c.Sf||t.code===c.gU||t.code===c.wU?(console.log("connection closed by server with code:",t.code),S("An error occurred while getting the Health Report file."),e((0,h.f7)(a))):(console.log("connection closed by server"),S("Health Report file is ready to be downloaded."),e((0,h.f7)(l)))})}else f(!1)},[g,e]);return(0,n.useEffect)(()=>{e((0,h.ph)("health_info"))},[e]),(0,p.jsxs)(n.Fragment,{children:[(0,p.jsx)(j.A,{label:"Health",actions:(0,p.jsx)(m.A,{})}),(0,p.jsxs)(o.Mxu,{children:[(0,p.jsx)(o.azJ,{withBorders:!0,children:(0,p.jsx)(u,{title:H,children:(0,p.jsx)(o.xA9,{container:!0,sx:{justifyContent:"flex-start",gap:20},children:(0,p.jsxs)(o.xA9,{item:!0,xs:12,sx:{textAlign:"center",marginBottom:25},children:[(0,p.jsx)("h2",{children:v}),(0,p.jsxs)(o.azJ,{sx:{textAlign:"center",marginBottom:25},children:[" ",""!==k&&!k.toLowerCase().includes("error")&&(0,p.jsxs)(o.xA9,{item:!0,xs:12,children:[(0,p.jsx)("strong",{children:"Health report generated successfully!"}),"\xa0"," ",(0,p.jsx)("strong",{children:"You can download the the Health report JSON File."})]}),(""===k||k.toLowerCase().includes("error"))&&s===l&&(0,p.jsxs)(o.xA9,{item:!0,xs:12,children:[(0,p.jsx)("strong",{children:"Something went wrong."}),"\xa0"," ",(0,p.jsx)("strong",{children:"May try again or download Health report JSON File."})]})]}),s===i?(0,p.jsx)(o.azJ,{sx:{paddingTop:8,paddingLeft:40},children:(0,p.jsx)(o.aHM,{style:{width:25,height:25}})}):(0,p.jsx)(n.Fragment,{children:(0,p.jsxs)(o.azJ,{sx:{display:"flex",gap:10,alignItems:"center",justifyContent:"center"},children:[(0,p.jsx)(o.azJ,{children:s!==a&&!w&&(0,p.jsx)(o.$nd,{id:"download",type:"submit",variant:"callAction",onClick:()=>(()=>{let e=document.createElement("a");e.setAttribute("href","data:application/gzip;base64,".concat(C)),e.setAttribute("download","diagnostic.json.gz"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)})(),disabled:w,label:"Download"})}),(0,p.jsx)(o.azJ,{children:(0,p.jsx)(o.$nd,{id:"start-new-diagnostic",type:"submit",variant:"callAction",disabled:g,onClick:()=>{f(!0)},label:y})})]})})]},"start-download")})})}),!g&&(0,p.jsxs)(n.Fragment,{children:[(0,p.jsx)("br",{}),(0,p.jsx)(o.lVp,{title:"Cluster Health Report will be generated, you will be able to download the JSON File.",iconComponent:(0,p.jsx)(o.mo0,{}),help:"If the Health report cannot be generated at this time, please wait a moment and try again."})]})]})]})}}}]);